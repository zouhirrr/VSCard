<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Qrestige Imperial | Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ†</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --accent: #00d2ff; --bg: #050505; --panel: #111111; --gold: #d4af37; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif !important; transition: 0.2s; }
        body { background: var(--bg); color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        .sidebar { width: 450px; background: var(--panel); border-left: 1px solid #222; padding: 25px; overflow-y: auto; scrollbar-width: thin; }
        .sidebar h2 { font-weight: 900; letter-spacing: 1px; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 10px; }

        .field-group { background: #1a1a1a; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #222; }
        label { font-size: 11px; font-weight: 800; color: #666; display: block; margin-bottom: 8px; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        input:focus { border-color: var(--gold); }

        .viewer { flex: 1; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #111, #000); position: relative; }
        .main-card { background: #fff; padding: 40px; border-radius: 40px; text-align: center; box-shadow: 0 0 50px rgba(212,175,55,0.1); width: 450px; }
        .main-card.dark-mode { background: #111; border: 1px solid #333; }
        
        .btn { padding: 14px; border-radius: 10px; border: none; font-weight: 900; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-outline { background: transparent; border: 1px solid #444; color: #fff; }
        .btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        
        .grid-colors { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        .color-dot { height: 30px; border-radius: 5px; cursor: pointer; border: 1px solid #333; }
    </style>
</head>
<body>

<aside class="sidebar">
    <h2>Qrestige Imperial</h2>
    
    <div class="field-group">
        <label>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
        <input type="text" id="v-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" oninput="draw()">
        <input type="text" id="v-title" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" oninput="draw()" style="margin-top:5px">
    </div>

    <div class="field-group">
        <label>Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„</label>
        <input type="tel" id="v-tel" placeholder="ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø«Ø§Ù„: 9665...)" oninput="draw()">
        <input type="text" id="v-link" placeholder="Ø±Ø§Ø¨Ø· LinkedIn Ø£Ùˆ Ù…ÙˆÙ‚Ø¹Ùƒ" oninput="draw()" style="margin-top:5px">
    </div>

    <div class="field-group">
        <label>ØªØ®ØµÙŠØµ Ø§Ù„Ù‡ÙˆÙŠØ© (Ø§Ù„Ø£Ù„ÙˆØ§Ù†)</label>
        <div class="grid-colors">
            <div class="color-dot" style="background:#d4af37" onclick="applyColor('#d4af37')"></div>
            <div class="color-dot" style="background:#00d2ff" onclick="applyColor('#00d2ff')"></div>
            <div class="color-dot" style="background:#ff0055" onclick="applyColor('#ff0055')"></div>
            <div class="color-dot" style="background:#2ecc71" onclick="applyColor('#2ecc71')"></div>
            <div class="color-dot" style="background:#ffffff" onclick="applyColor('#000000')"></div>
        </div>
        <input type="color" id="custom-color" oninput="applyColor(this.value)" style="margin-top:10px; height:30px; padding:0;">
    </div>

    <div class="field-group">
        <label>ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© (Logo)</label>
        <input type="file" accept="image/*" onchange="loadLogo(this)">
    </div>

    <div class="field-group">
        <label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</label>
        <select id="qr-dots" onchange="draw()">
            <option value="extra-rounded">Ù†Ù‚Ø§Ø· Ù†Ø§Ø¹Ù…Ø©</option>
            <option value="classy-rounded">Ù†Ù‚Ø§Ø· ÙØ®Ù…Ø©</option>
            <option value="square">Ù…Ø±Ø¨Ø¹Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ©</option>
        </select>
        <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="is-trans" onchange="draw()" style="width:20px;">
            <label style="margin:0">Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ©</label>
        </div>
    </div>

    <button class="btn btn-gold" onclick="exportPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§Ø®Ø±Ø©</button>
    <button class="btn btn-outline" onclick="exportPNG()">ğŸ–¼ï¸ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© PNG</button>
    <button class="btn btn-outline" onclick="exportVCF()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù vCard</button>
</aside>

<main class="viewer">
    <div id="capture-box" class="main-card">
        <div id="qr-display"></div>
        <div style="margin-top:25px; border-top:1px solid #f0f0f0; padding-top:20px;">
            <div id="p-name" style="font-size:28px; font-weight:900; color:#111">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…</div>
            <div id="p-title" style="color:#888; font-size:15px; margin-top:5px;">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</div>
            <div id="p-tel" style="color:#d4af37; font-weight:bold; margin-top:10px; font-size:14px;"></div>
        </div>
    </div>
</main>

<script>
    function encodeQP(str) {
        if (!str) return "";
        let utf8 = unescape(encodeURIComponent(str));
        let result = "";
        for (let i = 0; i < utf8.length; i++) {
            result += "=" + utf8.charCodeAt(i).toString(16).toUpperCase();
        }
        return result;
    }

    let currentLogo = null;
    let mainColor = "#d4af37";

    const qr = new QRCodeStyling({
        width: 350, height: 350,
        dotsOptions: { type: "extra-rounded", color: mainColor },
        imageOptions: { margin: 10, imageSize: 0.4, crossOrigin: "anonymous" },
        backgroundOptions: { color: "#ffffff" }
    });

    qr.append(document.getElementById("qr-display"));

    function loadLogo(input) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => { currentLogo = e.target.result; draw(); };
            r.readAsDataURL(input.files[0]);
        }
    }

    function applyColor(color) {
        mainColor = color;
        draw();
    }

    function draw() {
        const name = document.getElementById('v-name').value || "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…";
        const title = document.getElementById('v-title').value || "Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ";
        const tel = document.getElementById('v-tel').value;
        const link = document.getElementById('v-link').value;
        const isT = document.getElementById('is-trans').checked;
        const dotType = document.getElementById('qr-dots').value;

        document.getElementById('p-name').innerText = name;
        document.getElementById('p-title').innerText = title;
        document.getElementById('p-tel').innerText = tel ? "ğŸ“± " + tel : "";
        document.getElementById('p-name').style.color = isT ? mainColor : "#111";
        document.getElementById('capture-box').style.background = isT ? "transparent" : "#fff";
        document.getElementById('capture-box').style.border = isT ? "2px dashed #444" : "none";

        const vcard = [
            "BEGIN:VCARD", "VERSION:3.0",
            `FN;CHARSET=UTF-8;ENCODING=QUOTED-PRINTABLE:${encodeQP(name)}`,
            `TITLE;CHARSET=UTF-8;ENCODING=QUOTED-PRINTABLE:${encodeQP(title)}`,
            `TEL;TYPE=CELL,VOICE:${tel}`,
            `URL:${link}`, "END:VCARD"
        ].join("\r\n");

        qr.update({
            data: vcard,
            dotsOptions: { color: mainColor, type: dotType },
            cornersSquareOptions: { color: mainColor, type: "extra-rounded" },
            backgroundOptions: { color: isT ? "transparent" : "#ffffff" },
            image: currentLogo
        });
    }

    async function exportPDF() {
        const node = document.getElementById('capture-box');
        const canvas = await html2canvas(node, { scale: 5, backgroundColor: null });
        const pdf = new jspdf.jsPDF('p', 'px', [canvas.width/2, canvas.height/2]);
        pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, canvas.width/2, canvas.height/2);
        pdf.save(`${document.getElementById('v-name').value || 'Qrestige'}_Imperial.pdf`);
    }

    function exportPNG() { qr.download({ name: "Qrestige_vCard", extension: "png" }); }

    function exportVCF() {
        const n = document.getElementById('v-name').value || "Contact";
        const data = `BEGIN:VCARD\nVERSION:3.0\nFN:${n}\nTEL:${document.getElementById('v-tel').value}\nEND:VCARD`;
        const blob = new Blob([data], { type: 'text/vcard' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `${n}.vcf`; a.click();
    }

    draw();
</script>
</body>
</html>
